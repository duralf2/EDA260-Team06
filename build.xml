<?xml version="1.0" encoding="UTF-8"?>
<project name="Enduro.makejar" default="main" basedir=".">  <!--Starts script at main-->

	<target name="clean" description="Destroys all previously generated files and dirs.">
		<delete dir="build" />
		<delete dir="testreports" />
	</target>

	<target name="compile">
		<javac srcdir="src" destdir="bin" includeAntRuntime="true" />
	</target>

	<target name="jar" depends="compile">
		<mkdir dir="build/jar" />
		<jar destfile="build/jar/program.jar" basedir="bin">
			<manifest>
				<attribute name="Main-Class" value="sorter.SorterMain" /> <!--Sets the main class of the program -->
			</manifest>
		</jar>
	</target>

	<target name="main" depends="clean,jar,test" />  <!--Runs clean, jar and test in order-->

	<target name="test">

		<mkdir dir="testreports" />

		<junit printsummary="yes" haltonfailure="no">
			<classpath>
				<pathelement location="lib/hamcrest-core-1.3.jar" />
				<pathelement location="lib/junit-4.12.jar" />
				<pathelement location="lib/jcsv-1.4.0.jar" />
				<pathelement path="bin" />
			</classpath>

			<formatter type="xml" />

			<batchtest fork="yes" todir="testreports">
				<fileset dir="src">
					<include name="tests/*" />
				</fileset>
			</batchtest>
		</junit>
		
		<junitreport todir="testreports"> <!--Merge test results into one file (TestSuites.xml)-->
	            <fileset dir="testreports">
	                    <include name="TEST-*.xml" />
	            </fileset>
	    </junitreport>

	</target>
</project>